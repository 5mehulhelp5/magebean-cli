#!/usr/bin/env php
<?php
declare(strict_types=1);

// Avoid stale code during dev
if (PHP_SAPI === 'cli') {
    ini_set('opcache.enable_cli', '0');
}

require \dirname(__DIR__) . '/vendor/autoload.php';

use Magebean\Application;

$app = new Application();

/**
 * If the user called global --help (or -h) WITHOUT a specific command,
 * temporarily switch to single-command mode so that the help of `scan`
 * is shown instead of the default `list` help.
 */
$argv = $_SERVER['argv'] ?? [];

// Count non-option args (first arg is script name)
$nonOptionArgs = [];
foreach ($argv as $i => $arg) {
    if ($i === 0) continue;           // skip script name
    if (strlen($arg) > 0 && $arg[0] !== '-') {
        $nonOptionArgs[] = $arg;      // this would be a command name or operand
    }
}
$hasExplicitCommand = count($nonOptionArgs) > 0;
$app->setDefaultCommand('scan');
$app->run();
