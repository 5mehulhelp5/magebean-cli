{
  "control": "MB-C02",
  "title": "Admin & Auth Hardening",
  "rules": [
    {
      "id": "MB-R006",
      "title": "Non-default admin path (not /admin)",
      "control": "MB-C02",
      "severity": "high",
      "op": "all",
      "checks": [
        {
          "name": "php_array_neq",
          "args": {
            "file": "app/etc/env.php",
            "path": "backend.frontName",
            "not_equals": "admin"
          }
        }
      ],
      "messages": {
        "pass": "Admin path is non-default (not '/admin').",
        "fail": "Admin path is still '/admin'. Change env.php backend.frontName to a non-guessable value and update web server rules."
      }
    },
    {
      "id": "MB-R007",
      "title": "Admin 2FA module enabled",
      "control": "MB-C02",
      "severity": "critical",
      "op": "all",
      "checks": [
        {
          "name": "php_array_eq",
          "args": {
            "file": "app/etc/config.php",
            "path": "modules.Magento_TwoFactorAuth",
            "equals": 1
          }
        }
      ],
      "messages": {
        "pass": "Two-Factor Authentication (Magento_TwoFactorAuth) is enabled for admin.",
        "fail": "Two-Factor Authentication is disabled or missing. Enable Magento_TwoFactorAuth and enforce 2FA for all admin users."
      }
    },
    {
      "id": "MB-R008",
      "title": "Strong password policy enforced",
      "control": "MB-C02",
      "severity": "high",
      "op": "all",
      "checks": [
        {
          "name": "php_array_exists",
          "args": {
            "file": "app/etc/config.php",
            "path": "system.default.admin/security"
          }
        }
      ],
      "messages": {
        "pass": "Admin password/security policy is configured (system.default.admin/security present).",
        "fail": "Admin password/security policy is not configured. Define complexity, history, lockout, and rotation settings under admin/security."
      }
    },
    {
      "id": "MB-R009",
      "title": "Admin session timeout <= 900s",
      "control": "MB-C02",
      "severity": "medium",
      "op": "all",
      "checks": [
        {
          "name": "php_array_numeric_compare",
          "args": {
            "file": "app/etc/env.php",
            "path": "session.lifetime",
            "op": "<=",
            "value": 900
          }
        }
      ],
      "messages": {
        "pass": "Admin session lifetime is at or below 900 seconds.",
        "fail": "Admin session lifetime exceeds 900 seconds. Reduce session.lifetime to â‰¤ 900 for better security."
      }
    },
    {
      "id": "MB-R010",
      "title": "Admin URL exposure restricted",
      "control": "MB-C02",
      "severity": "medium",
      "op": "all",
      "checks": [
        {
          "name": "php_array_neq",
          "args": {
            "file": "app/etc/env.php",
            "path": "backend.frontName",
            "not_equals": "admin"
          }
        }
      ],
      "messages": {
        "pass": "Admin URL is either non-default or network-restricted (deny/allow rules present).",
        "fail": "Admin URL is exposed (default path and no network ACLs). Change backend.frontName and/or restrict access via web server allow/deny."
      }
    },
    {
      "id": "MB-R011",
      "title": "Login rate-limiting / CAPTCHA enabled",
      "control": "MB-C02",
      "severity": "medium",
      "op": "all",
      "checks": [
        {
          "name": "php_array_exists",
          "args": {
            "file": "app/etc/config.php",
            "path": "system.default.admin/captcha"
          }
        }
      ],
      "messages": {
        "pass": "CAPTCHA / rate-limiting is configured for admin authentication.",
        "fail": "CAPTCHA / rate-limiting is not configured. Enable admin CAPTCHA (or reCAPTCHA) to slow brute-force attempts."
      }
    }
  ]
}
