{
  "control": "MB-C05",
  "title": "Production Mode & Deployment Hygiene",
  "rules": [
    {
      "id": "MB-R031",
      "title": "Magento runs in PRODUCTION mode",
      "control": "MB-C05",
      "severity": "high",
      "op": "all",
      "checks": [
        {
          "name": "php_array_eq",
          "args": {
            "file": "app/etc/env.php",
            "path": "MAGE_MODE",
            "equals": "production"
          }
        }
      ],
      "messages": {
        "pass": "Magento is running in PRODUCTION mode.",
        "fail": "Magento is not in PRODUCTION mode. Set MAGE_MODE to 'production' in env.php and redeploy."
      }
    },
    {
      "id": "MB-R032",
      "title": "Xdebug disabled in production",
      "control": "MB-C05",
      "severity": "medium",
      "op": "all",
      "checks": [
        {
          "name": "text_grep",
          "args": {
            "file": "php.ini",
            "must_not_match": [
              "zend_extension\\s*=\\s*xdebug",
              "^\\s*xdebug\\.mode\\s*="
            ]
          }
        }
      ],
      "messages": {
        "pass": "Xdebug is not enabled in the production PHP configuration.",
        "fail": "Xdebug settings detected. Remove the zend_extension and xdebug.* directives in production."
      }
    },
    {
      "id": "MB-R033",
      "title": "display_errors is Off",
      "control": "MB-C05",
      "severity": "medium",
      "op": "all",
      "checks": [
        {
          "name": "text_grep",
          "args": {
            "file": "php.ini",
            "must_match": [
              "display_errors\\s*=\\s*Off"
            ]
          }
        }
      ],
      "messages": {
        "pass": "PHP display_errors is Off.",
        "fail": "PHP display_errors is On. Set display_errors=Off and log errors to files instead."
      }
    },
    {
      "id": "MB-R034",
      "title": "Compiled DI generated (metadata & code)",
      "control": "MB-C05",
      "severity": "low",
      "op": "all",
      "checks": [
        {
          "name": "fs_exists",
          "args": {
            "path": "generated/metadata"
          }
        },
        {
          "name": "fs_exists",
          "args": {
            "path": "generated/code"
          }
        }
      ],
      "messages": {
        "pass": "Generated DI metadata and code are present.",
        "fail": "Missing generated/metadata or generated/code. Run `bin/magento setup:di:compile`."
      }
    },
    {
      "id": "MB-R035",
      "title": "Static content deployed",
      "control": "MB-C05",
      "severity": "low",
      "op": "all",
      "checks": [
        {
          "name": "fs_exists",
          "args": {
            "path": "pub/static"
          }
        },
        {
          "name": "fs_exists",
          "args": {
            "path": "var/view_preprocessed"
          }
        }
      ],
      "messages": {
        "pass": "Static view files are deployed (pub/static and var/view_preprocessed exist).",
        "fail": "Static content is not fully deployed. Run `bin/magento setup:static-content:deploy` for production."
      }
    },
    {
      "id": "MB-R036",
      "title": "No dev debug configs on production (template hints off)",
      "control": "MB-C05",
      "severity": "medium",
      "op": "any",
      "checks": [
        {
          "name": "php_array_eq",
          "args": {
            "file": "app/etc/env.php",
            "path": "system.default.dev/debug/template_hints",
            "equals": 0
          }
        },
        {
          "name": "php_array_absent",
          "args": {
            "file": "app/etc/env.php",
            "path": "system.default.dev/debug/template_hints"
          }
        }
      ],
      "messages": {
        "pass": "Developer template hints are disabled in production.",
        "fail": "Developer template hints are enabled. Disable system.default.dev/debug/template_hints (set to 0)."
      }
    }
  ]
}