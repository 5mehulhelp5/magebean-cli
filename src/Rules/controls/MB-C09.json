{
  "control": "MB-C09",
  "title": "Extension Vulnerability Management",
  "rules": [
    {
      "id": "MB-R049",
      "title": "No vulnerable packages (CVE via OSV)",
      "control": "MB-C09",
      "severity": "critical",
      "op": "all",
      "checks": [
        {
          "name": "composer_audit_offline",
          "args": {
            "lock_file": "composer.lock",
            "cve_db": "rules/osv-db.json"
          }
        }
      ],
      "messages": {
        "pass": "No vulnerable packages detected against the offline OSV database.",
        "fail": "Vulnerable packages found. Upgrade or patch affected versions per OSV advisories."
      }
    },
    {
      "id": "MB-R050",
      "title": "Adobe core module advisories resolved",
      "control": "MB-C09",
      "severity": "critical",
      "op": "all",
      "checks": [
        {
          "name": "composer_core_advisories_offline",
          "args": {
            "lock_file": "composer.lock",
            "advisories": "rules/adobe-core-advisories.json"
          }
        }
      ],
      "messages": {
        "pass": "No unresolved Adobe core advisories detected.",
        "fail": "Unresolved Adobe core advisories present. Apply the recommended patches or versions."
      }
    },
    {
      "id": "MB-R051",
      "title": "Suggest fixed versions for vulnerable packages",
      "control": "MB-C09",
      "severity": "medium",
      "op": "all",
      "checks": [
        {
          "name": "composer_fix_version",
          "args": {
            "lock_file": "composer.lock",
            "cve_db": "rules/osv-db.json"
          }
        }
      ],
      "messages": {
        "pass": "Fix versions are available for all known vulnerable packages.",
        "fail": "Some vulnerable packages lack an applied fix version. Pin or upgrade to the suggested safe version."
      }
    },
    {
      "id": "MB-R052",
      "title": "High-risk modules flagged",
      "control": "MB-C09",
      "severity": "medium",
      "op": "all",
      "checks": [
        {
          "name": "composer_risk_surface_tag",
          "args": {
            "lock_file": "composer.lock",
            "high_risk_list": "rules/high-risk-modules.json"
          }
        }
      ],
      "messages": {
        "pass": "No high-risk modules from the list are installed, or they are acknowledged and controlled.",
        "fail": "High-risk modules detected. Review, sandbox, restrict scope, or replace with safer alternatives."
      }
    },
    {
      "id": "MB-R053",
      "title": "Temporary mitigations documented",
      "control": "MB-C09",
      "severity": "low",
      "op": "all",
      "checks": [
        {
          "name": "fs_exists",
          "args": { "path": "SECURITY.md" }
        },
        {
          "name": "text_grep",
          "args": {
            "file": "SECURITY.md",
            "must_match": ["Mitigation", "Workaround"]
          }
        }
      ],
      "messages": {
        "pass": "Mitigations/workarounds are documented in SECURITY.md.",
        "fail": "No documented mitigations. Record temporary workarounds and rollback plans in SECURITY.md."
      }
    },
    {
      "id": "MB-R054",
      "title": "Known-exploited packages prioritized (CISA KEV)",
      "control": "MB-C09",
      "severity": "critical",
      "op": "all",
      "checks": [
        {
          "name": "composer_match_list",
          "args": {
            "lock_file": "composer.lock",
            "list": "rules/cisa-kev.json"
          }
        }
      ],
      "messages": {
        "pass": "No packages match the CISA Known Exploited Vulnerabilities list.",
        "fail": "Packages on the CISA KEV list detected. Prioritize immediate remediation."
      }
    },
    {
      "id": "MB-R055",
      "title": "Transitive dependencies checked for CVEs",
      "control": "MB-C09",
      "severity": "high",
      "op": "all",
      "checks": [
        {
          "name": "composer_audit_offline",
          "args": {
            "lock_file": "composer.lock",
            "cve_db": "rules/osv-db.json",
            "scope": "transitive"
          }
        }
      ],
      "messages": {
        "pass": "Transitive dependencies are free from known CVEs in the offline database.",
        "fail": "Vulnerable transitive dependencies detected. Update constraints to pull safe versions."
      }
    },
    {
      "id": "MB-R056",
      "title": "No constraints blocking security updates",
      "control": "MB-C09",
      "severity": "medium",
      "op": "all",
      "checks": [
        {
          "name": "composer_constraints_conflict",
          "args": {
            "json_file": "composer.json",
            "lock_file": "composer.lock",
            "advisory_fix": ">=x.y.z"
          }
        }
      ],
      "messages": {
        "pass": "Composer constraints do not block required security update ranges.",
        "fail": "Version constraints block security updates. Relax or adjust constraints to allow patched versions."
      }
    },
    {
      "id": "MB-R057",
      "title": "No yanked/withdrawn packages",
      "control": "MB-C09",
      "severity": "high",
      "op": "all",
      "checks": [
        {
          "name": "composer_yanked_offline",
          "args": {
            "lock_file": "composer.lock",
            "meta": "rules/packagist-yanked.json"
          }
        }
      ],
      "messages": {
        "pass": "No yanked or withdrawn packages are installed.",
        "fail": "Yanked/withdrawn packages detected. Replace or upgrade to a supported release."
      }
    },
    {
      "id": "MB-R058",
      "title": "No outdated Marketplace extensions",
      "control": "MB-C09",
      "severity": "medium",
      "op": "all",
      "checks": [
        {
          "name": "composer_outdated_offline",
          "args": {
            "lock_file": "composer.lock",
            "market_meta": "rules/marketplace-versions.json",
            "max_age_days": 365
          }
        }
      ],
      "messages": {
        "pass": "Installed extensions are within the allowed freshness window.",
        "fail": "Outdated extensions detected. Update to a maintained release."
      }
    },
    {
      "id": "MB-R059",
      "title": "Advisories handled in timely manner",
      "control": "MB-C09",
      "severity": "low",
      "op": "all",
      "checks": [
        {
          "name": "composer_advisory_latency",
          "args": {
            "lock_file": "composer.lock",
            "advisories": "rules/osv-db.json"
          }
        }
      ],
      "messages": {
        "pass": "Average advisory response time is within the accepted SLA.",
        "fail": "Advisory response time exceeds target. Tighten triage and patch workflows."
      }
    },
    {
      "id": "MB-R060",
      "title": "No extensions without vendor support",
      "control": "MB-C09",
      "severity": "medium",
      "op": "all",
      "checks": [
        {
          "name": "composer_vendor_support_offline",
          "args": {
            "lock_file": "composer.lock",
            "vendor_meta": "rules/vendor-support.json"
          }
        }
      ],
      "messages": {
        "pass": "All installed extensions have active vendor support.",
        "fail": "Unsupported extensions detected. Replace, remove, or fork and maintain internally."
      }
    }
  ]
}
