{
  "control": "MB-C11",
  "title": "Composer Dependency Hygiene",
  "rules": [
    {
      "id": "MB-R065",
      "title": "No wildcard constraints in composer.json",
      "control": "MB-C11",
      "severity": "medium",
      "op": "all",
      "checks": [
        {
          "name": "composer_json_constraints",
          "args": {
            "json_file": "composer.json",
            "deny": ["*", "dev-master"]
          }
        }
      ],
      "messages": {
        "pass": "No wildcard or 'dev-master' constraints found in composer.json.",
        "fail": "Wildcard or 'dev-master' constraints detected. Pin to stable, supported version ranges."
      }
    },
    {
      "id": "MB-R066",
      "title": "No dev branches in composer.json",
      "control": "MB-C11",
      "severity": "medium",
      "op": "all",
      "checks": [
        {
          "name": "composer_json_constraints",
          "args": {
            "json_file": "composer.json",
            "deny_prefix": ["dev-"]
          }
        }
      ],
      "messages": {
        "pass": "No dev branch constraints (dev-*) are used.",
        "fail": "Dev branch constraints detected. Replace with tagged releases or stable ranges."
      }
    },
    {
      "id": "MB-R067",
      "title": "prefer-stable=true in composer.json",
      "control": "MB-C11",
      "severity": "low",
      "op": "all",
      "checks": [
        {
          "name": "composer_json_kv",
          "args": {
            "json_file": "composer.json",
            "path": "config.prefer-stable",
            "equals": true
          }
        }
      ],
      "messages": {
        "pass": "composer.json sets config.prefer-stable=true.",
        "fail": "prefer-stable is not enabled. Set config.prefer-stable=true to favor stable releases."
      }
    },
    {
      "id": "MB-R068",
      "title": "Composer audit clean (no known vulns)",
      "control": "MB-C11",
      "severity": "critical",
      "op": "all",
      "checks": [
        {
          "name": "composer_audit_offline",
          "args": {
            "lock_file": "composer.lock",
            "cve_db": "rules/osv-db.json",
            "fail_on_found": true
          }
        }
      ],
      "messages": {
        "pass": "No known vulnerabilities found in composer.lock against the offline database.",
        "fail": "Known vulnerabilities detected. Update to patched versions per advisories."
      }
    },
    {
      "id": "MB-R069",
      "title": "Direct dependencies up-to-date",
      "control": "MB-C11",
      "severity": "medium",
      "op": "all",
      "checks": [
        {
          "name": "composer_outdated_offline",
          "args": {
            "lock_file": "composer.lock",
            "release_meta": "rules/release-history.json",
            "scope": "direct"
          }
        }
      ],
      "messages": {
        "pass": "All direct dependencies are within acceptable freshness.",
        "fail": "Outdated direct dependencies detected. Upgrade primary packages to recent stable releases."
      }
    },
    {
      "id": "MB-R070",
      "title": "composer.lock integrity with composer.json",
      "control": "MB-C11",
      "severity": "high",
      "op": "all",
      "checks": [
        {
          "name": "composer_lock_integrity",
          "args": {
            "json_file": "composer.json",
            "lock_file": "composer.lock"
          }
        }
      ],
      "messages": {
        "pass": "composer.lock is in sync with composer.json.",
        "fail": "composer.lock integrity check failed. Run `composer update` (or `composer install`) to reconcile."
      }
    },
    {
      "id": "MB-R071",
      "title": "No abandoned libraries allowed",
      "control": "MB-C11",
      "severity": "medium",
      "op": "all",
      "checks": [
        {
          "name": "composer_abandoned_offline",
          "args": {
            "lock_file": "composer.lock",
            "packagist_meta": "rules/packagist-abandoned.json"
          }
        }
      ],
      "messages": {
        "pass": "No installed libraries are marked as abandoned on Packagist.",
        "fail": "Abandoned libraries detected. Replace with maintained alternatives."
      }
    }
  ]
}
