{
  "control": "MB-C07",
  "title": "Logging & Monitoring",
  "rules": [
    {
      "id": "MB-R042",
      "title": "Logs and reports not exposed under pub/",
      "control": "MB-C07",
      "severity": "high",
      "op": "all",
      "checks": [
        {
          "name": "webroot_hygiene",
          "args": {
            "webroot": "pub",
            "forbidden": ["var/log", "var/report"]
          }
        }
      ],
      "messages": {
        "pass": "Log and report directories are not exposed under pub/.",
        "fail": "Log or report directories are exposed in pub/. Move them out of the webroot."
      }
    },
    {
      "id": "MB-R043",
      "title": "Log rotation configured",
      "control": "MB-C07",
      "severity": "medium",
      "op": "all",
      "checks": [
        {
          "name": "text_grep",
          "args": {
            "file": "devops/logrotate.conf",
            "must_match": ["rotate", "compress"]
          }
        }
      ],
      "messages": {
        "pass": "Log rotation is configured (rotate and compress directives present).",
        "fail": "Log rotation is not configured. Add logrotate settings to prevent oversized log files."
      }
    },
    {
      "id": "MB-R044",
      "title": "Debug template hints disabled in production",
      "control": "MB-C07",
      "severity": "medium",
      "op": "all",
      "checks": [
        {
          "name": "php_array_eq",
          "args": {
            "file": "app/etc/env.php",
            "path": "dev/debug/template_hints_storefront",
            "equals": 0
          }
        }
      ],
      "messages": {
        "pass": "Debug template hints are disabled in production.",
        "fail": "Debug template hints are enabled in production. Set dev/debug/template_hints_storefront to 0."
      }
    },
    {
      "id": "MB-R045",
      "title": "PII not logged in application logs",
      "control": "MB-C07",
      "severity": "high",
      "op": "all",
      "checks": [
        {
          "name": "code_grep",
          "args": {
            "paths": ["app"],
            "include_ext": ["php"],
            "must_not_match": [
              "logger->(info|debug|notice)\\([^)]*password",
              "logger->(info|debug|notice)\\([^)]*Authorization",
              "logger->(info|debug|notice)\\([^)]*(card_number|cvv)"
            ]
          }
        }
      ],
      "messages": {
        "pass": "No PII such as passwords, tokens, or card data is logged.",
        "fail": "Sensitive PII is logged. Remove logging of passwords, tokens, and card details."
      }
    }
  ]
}
